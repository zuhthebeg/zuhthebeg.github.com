<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Îã§Îã®Í≥Ñ Ïà´Ïûê ÌçºÏ¶ê</title>
    <style>
        :root {
            --tile-size: min(18vw, 70px);
            --main-color: #2c3e50;
            --correct-color: #2ecc71;
            --empty-color: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            background: #f5f6fa;
            touch-action: manipulation;
        }

        #game-container {
            margin: 2vh auto;
            padding: 2vh;
            width: 95%;
            max-width: 500px;
        }

        #level-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 2vh;
            justify-content: center;
        }

        .level-btn {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .level-btn.active {
            background: #2980b9;
        }

        #stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2vh;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #puzzle-board {
            display: grid;
            background: var(--main-color);
            padding: 0.5vmin;
            border-radius: 8px;
            touch-action: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 0 auto;
        }

        .tile {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            font-size: calc(var(--tile-size) * 0.35);
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: 
                transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                background-color 0.3s;
            color: var(--main-color);
            border-radius: 4px;
        }

        .tile.correct {
            background: var(--correct-color);
            color: white;
        }

        .tile.empty {
            background: var(--empty-color);
            cursor: default;
            visibility: visible !important;
        }

        button {
            padding: 12px 24px;
            font-size: 14px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 2vh;
            width: 100%;
            max-width: 200px;
            transition: transform 0.2s;
        }

        button:active {
            transform: scale(0.96);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="level-selector">
            <button class="level-btn active" data-size="3">3x3</button>
            <button class="level-btn" data-size="4">4x4</button>
            <button class="level-btn" data-size="5">5x5</button>
        </div>
        <div id="stats">
            <div>‚è± <span id="timer">0</span>Ï¥à</div>
            <div>üö∂‚ôÄÔ∏è <span id="moves">0</span>Ìöå</div>
        </div>
        <div id="puzzle-board"></div>
        <button onclick="startNewGame()">ÏÉà Í≤åÏûÑ</button>
    </div>

    <script>
        let currentLevel = 4;
        let moves = 0;
        let timer = 0;
        let timerInterval;
        let tiles = [];
        const board = document.getElementById('puzzle-board');

        // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
        function initGame(size) {
            currentLevel = size;
            resetGame();
            generateBoard(size);
            addLevelEventListeners();
        }

        // Î≥¥Îìú ÏÉùÏÑ±
        function generateBoard(size) {
            board.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            board.style.gap = '0.5vmin';
            
            tiles = Array.from({length: size * size - 1}, (_, i) => {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.textContent = i + 1;
                tile.style.width = `calc(${100/size}% - 0.5vmin)`;
                tile.style.height = `calc(${100/size}% - 0.5vmin)`;
                tile.addEventListener('click', () => moveTile(i + 1));
                return tile;
            });
            
            tiles.push(null); // Îπà ÌÉÄÏùº
            shuffleTiles();
        }

        // ÌÉÄÏùº ÏÑûÍ∏∞
        function shuffleTiles() {
            resetGame();
            let shuffledTiles = [...tiles.slice(0, -1)].sort(() => Math.random() - 0.5);
            shuffledTiles.push(null);
            updateBoard(shuffledTiles);
        }

        // ÌÉÄÏùº Ïù¥Îèô
        function moveTile(number) {
            const currentIndex = tiles.findIndex(t => t?.textContent == number);
            const emptyIndex = tiles.indexOf(null);
            
            if(isAdjacent(currentIndex, emptyIndex)) {
                animateTileMovement(currentIndex, emptyIndex);
                [tiles[currentIndex], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[currentIndex]];
                moves++;
                document.getElementById('moves').textContent = moves;
                checkWin();
                updateTileStates();
            }
        }

        // Ïï†ÎãàÎ©îÏù¥ÏÖò Ï≤òÎ¶¨
        function animateTileMovement(from, to) {
            const tile = tiles[from];
            tile.style.transform = `translate(${(to%currentLevel - from%currentLevel)*100}%, ${(Math.floor(to/currentLevel) - Math.floor(from/currentLevel))*100}%)`;
            
            setTimeout(() => {
                tile.style.transform = 'none';
                updateBoard(tiles);
            }, 300);
        }

        // Ïù∏Ï†ë Ïó¨Î∂Ä ÌôïÏù∏
        function isAdjacent(a, b) {
            if(a === -1 || b === -1) return false;
            const rowA = Math.floor(a / currentLevel);
            const colA = a % currentLevel;
            const rowB = Math.floor(b / currentLevel);
            const colB = b % currentLevel;
            return Math.abs(rowA - rowB) + Math.abs(colA - colB) === 1;
        }

        // Î≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateBoard(tileArray) {
            board.innerHTML = '';
            tileArray.forEach(tile => {
                if(tile) {
                    board.appendChild(tile);
                } else {
                    const empty = document.createElement('div');
                    empty.className = 'tile empty';
                    empty.style.width = `calc(${100/currentLevel}% - 0.5vmin)`;
                    empty.style.height = `calc(${100/currentLevel}% - 0.5vmin)`;
                    board.appendChild(empty);
                }
            });
        }

        // Ï†ïÎãµ ÏÉÅÌÉú ÌôïÏù∏
        function updateTileStates() {
            tiles.forEach((tile, index) => {
                if(tile) {
                    const shouldBe = parseInt(tile.textContent);
                    tile.classList.toggle('correct', index === shouldBe - 1);
                }
            });
        }

        // ÏäπÎ¶¨ Ï°∞Í±¥ ÌôïÏù∏
        function checkWin() {
            const winCondition = tiles.slice(0, -1).every((tile, index) => 
                tile?.textContent == index + 1
            );
            
            if(winCondition) {
                clearInterval(timerInterval);
                setTimeout(() => {
                    alert(`üéâ Î†àÎ≤® ${currentLevel}x${currentLevel} ÌÅ¥Î¶¨Ïñ¥!\nÏãúÍ∞Ñ: ${timer}Ï¥à\nÏù¥Îèô ÌöüÏàò: ${moves}Ìöå`);
                }, 300);
            }
        }

        // Í≤åÏûÑ Î¶¨ÏÖã
        function resetGame() {
            moves = 0;
            timer = 0;
            clearInterval(timerInterval);
            document.getElementById('moves').textContent = 0;
            document.getElementById('timer').textContent = 0;
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById('timer').textContent = timer;
            }, 1000);
        }

        // Î†àÎ≤® ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
        function addLevelEventListeners() {
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.level-btn').forEach(b => 
                        b.classList.remove('active'));
                    btn.classList.add('active');
                    initGame(parseInt(btn.dataset.size));
                });
            });
        }

        // ÏÉà Í≤åÏûÑ ÏãúÏûë
        function startNewGame() {
            initGame(currentLevel);
        }

        // Ï¥àÍ∏∞ Ïã§Ìñâ
        initGame(3);
    </script>
</body>
</html>